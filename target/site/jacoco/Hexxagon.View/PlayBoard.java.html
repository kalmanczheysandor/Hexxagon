<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PlayBoard.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Hexxagon</a> &gt; <a href="index.source.html" class="el_package">Hexxagon.View</a> &gt; <span class="el_source">PlayBoard.java</span></div><h1>PlayBoard.java</h1><pre class="source lang-java linenums">package Hexxagon.View;

import Hexxagon.Controller.IGameController;
import Hexxagon.Model.GameData;
import Support.TError;
import Support.mvc.TView;
import java.beans.PropertyChangeEvent;
import java.util.ArrayList;

import javafx.animation.ScaleTransition;
import javafx.animation.ScaleTransitionBuilder;
import javafx.animation.StrokeTransition;
import javafx.animation.StrokeTransitionBuilder;
import javafx.event.EventHandler;
import javafx.scene.Node;
import javafx.scene.input.MouseEvent;
import javafx.scene.paint.Color;
import javafx.scene.paint.CycleMethod;
import javafx.scene.paint.LinearGradient;
import javafx.scene.paint.RadialGradient;
import javafx.scene.paint.Stop;
import javafx.scene.shape.Polygon;
import javafx.scene.shape.StrokeLineJoin;
import javafx.scene.shape.StrokeType;
import javafx.util.Duration;
import javafx.scene.layout.Pane;
import Hexxagon.Controller.IPlayer;
import Hexxagon.Model.IField;
import Hexxagon.Model.IGameData;
import javafx.scene.control.Alert;
import javafx.scene.control.ButtonType;
import javafx.scene.control.DialogPane;
import javafx.scene.effect.DropShadow;
import javafx.scene.layout.AnchorPane;
import javafx.scene.media.AudioClip;
import javafx.scene.text.Text;
import javafx.stage.Modality;
import javafx.stage.StageStyle;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * Instance of this class realises a virtual game board as a JavaFX specific graphical node.
 *
 * @author Sandor Kalmanchey
 * @version 2.0
 * @since 2.0
 */
public class PlayBoard extends TView implements IPlayBoard {

    /**
     * The logger.
     */
<span class="nc" id="L54">    private static final Logger logger = LoggerFactory.getLogger(PlayBoard.class);</span>
    /**
     * List of relative coordinates of attack zone.
     */
<span class="nc" id="L58">    private static final Coordinate[] relativeCoordinatesOfAttackZone = {</span>
        /*C-2*/new Coordinate(-2, 0), new Coordinate(-2, 1), new Coordinate(-2, 2),
        /*C-1*/ new Coordinate(-1, -1), new Coordinate(-1, 0), new Coordinate(-1, +1), new Coordinate(-1, +2),
        /*C0*/ new Coordinate(0, -2), new Coordinate(0, -1), new Coordinate(0, 1), new Coordinate(0, 2),
        /*C+1*/ new Coordinate(1, -2), new Coordinate(1, -1), new Coordinate(1, 0), new Coordinate(1, 1),
        /*C+2*/ new Coordinate(2, -2), new Coordinate(2, -1), new Coordinate(2, 0)
    };

    /**
     * List of cells represented by graphical nodes so called pits.
     */
<span class="nc" id="L69">    private ArrayList&lt;BoardPit&gt; pitList = new ArrayList&lt;BoardPit&gt;();</span>

    /**
     * Relative path of folder of css files.
     */
    private static final String folderCSS = &quot;/css&quot;;
    /**
     * Relative path of folder of image files.
     */
    private static final String folderImage = &quot;/image&quot;;
    /**
     * Relative path of folder of audio files.
     */
    private static final String folderAudio = &quot;/audio&quot;;

    //String SoundDirectoryPath = &quot;F:/Sound&quot;;
<span class="nc" id="L85">    private static AudioClip voiceNotAllowedPlayerSelected = new AudioClip(PlayBoard.class.getResource(PlayBoard.folderAudio + &quot;/reject.wav&quot;).toExternalForm());</span>
<span class="nc" id="L86">    private static AudioClip voiceOutside = new AudioClip(PlayBoard.class.getResource(PlayBoard.folderAudio + &quot;/reject.wav&quot;).toExternalForm());</span>
<span class="nc" id="L87">    private static AudioClip voiceSpreadWithJump = new AudioClip(PlayBoard.class.getResource(PlayBoard.folderAudio + &quot;/step.wav&quot;).toExternalForm());</span>
<span class="nc" id="L88">    private static AudioClip voiceSpreadWithNoJump = new AudioClip(PlayBoard.class.getResource(PlayBoard.folderAudio + &quot;/jump.wav&quot;).toExternalForm());</span>
<span class="nc" id="L89">    private static AudioClip voiceCapture = new AudioClip(PlayBoard.class.getResource(PlayBoard.folderAudio + &quot;/occupy.wav&quot;).toExternalForm());</span>
<span class="nc" id="L90">    private static AudioClip voiceShowSpreadArea = new AudioClip(PlayBoard.class.getResource(PlayBoard.folderAudio + &quot;/click.wav&quot;).toExternalForm());</span>
<span class="nc" id="L91">    private Pane rootNode = new Pane();</span>

<span class="nc" id="L93">    private Alert endGameDialog = new Alert(Alert.AlertType.NONE, &quot;&quot;, ButtonType.OK);</span>

    /**
     * Creates a {@code PlayBoard} instance.
     *
     * @param root JavaFX graphical node to where this graphical component would be attached.
     */
    public PlayBoard(Pane root) throws TError {
<span class="nc" id="L101">        super(root);</span>
<span class="nc" id="L102">        logger.trace(&quot;PlayBoard constructed!&quot;);</span>
<span class="nc" id="L103">        initialisation();</span>
<span class="nc" id="L104">    }</span>

    /**
     * Where sub component initialisation might happens.
     */
    private void initialisation() throws TError {

<span class="nc" id="L111">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public void show() throws TError {
        // Generate board if not exists
<span class="nc" id="L119">        this.createBoard();</span>
        
        // Do animation on all pit when the board becomes visible
<span class="nc" id="L122">        byte[][] stands = this.getDataInstance().getCells();</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">        for(int columnIndex = 0; columnIndex &lt; stands.length; columnIndex++) {</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">            for(int rowIndex = 0; rowIndex &lt; stands[columnIndex].length; rowIndex++) {</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">                if(stands[columnIndex][rowIndex] != -1) {</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">                    if(this.isPitExists(columnIndex, rowIndex)) {</span>
<span class="nc" id="L127">                    this.getPit(columnIndex, rowIndex).animateForStart();</span>
                    }
                }
            }
        }
        
<span class="nc" id="L133">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public void hide() {
        //this.RootNode.getChildren().remove(this);
<span class="nc" id="L141">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public void refresh() throws TError {

        
        // Generate board if not exists
<span class="nc" id="L151">        this.createBoard();</span>

        //
<span class="nc" id="L154">        byte[][] stands = this.getDataInstance().getCells();</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">        for(int columnIndex = 0; columnIndex &lt; stands.length; columnIndex++) {</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">            for(int rowIndex = 0; rowIndex &lt; stands[columnIndex].length; rowIndex++) {</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">                if(isPitExists(columnIndex, rowIndex)) {</span>
<span class="nc" id="L158">                    BoardPit pit = this.getPit(columnIndex, rowIndex);</span>
<span class="nc" id="L159">                    pit.checkState();</span>
                }
            }
        }
<span class="nc" id="L163">    }</span>

    /**
     * Creates the board.
     *
     * @throws TError Thrown if an unrecoverable error was occurred.
     */
    private final void createBoard() throws TError {

<span class="nc bnc" id="L172" title="All 2 branches missed.">        if(this.getUIRoot().getChildren().contains(this.rootNode)) {</span>
<span class="nc" id="L173">            this.getUIRoot().getChildren().remove(this.rootNode);</span>
        }

<span class="nc" id="L176">        Pane root = new Pane();</span>
<span class="nc" id="L177">        this.rootNode = null;</span>
<span class="nc" id="L178">        pitList.clear();</span>

<span class="nc" id="L180">        byte[][] stands = this.getDataInstance().getCells();</span>

<span class="nc bnc" id="L182" title="All 2 branches missed.">        for(int columnIndex = 0; columnIndex &lt; stands.length; columnIndex++) { //Columns</span>

<span class="nc" id="L184">            int posX = -50 + ((columnIndex) * 44);</span>
<span class="nc" id="L185">            int posY = 250 - ((columnIndex + 1) * 22);</span>

<span class="nc bnc" id="L187" title="All 2 branches missed.">            for(int rowIndex = 0; rowIndex &lt; stands[columnIndex].length; rowIndex++) {</span>

<span class="nc bnc" id="L189" title="All 2 branches missed.">                if(stands[columnIndex][rowIndex] &gt;= 0) {</span>
<span class="nc" id="L190">                    BoardPit pit = new BoardPit(this, posX + (rowIndex) * 44, posY + (rowIndex) * 22, columnIndex, rowIndex);</span>
<span class="nc" id="L191">                    pitList.add(pit);</span>
<span class="nc" id="L192">                    root.getChildren().add(pit);</span>
<span class="nc" id="L193">                    pit.checkState();</span>
                }
            }
        }
<span class="nc" id="L197">        this.rootNode = root;</span>

<span class="nc" id="L199">        this.getUIRoot().getChildren().add(root);</span>

        /*if(!this.getUIRoot().getChildren().contains(this.rootNode)) {
            //
            byte[][] stands = this.getDataInstance().getCells();

            //
            for(int columnIndex = 0; columnIndex &lt; stands.length; columnIndex++) { //Columns

                // CreateAColumn
                int posX = -50 + ((columnIndex ) * 50);
                int posY = 250 - ((columnIndex + 1) * 22);

                for(int rowIndex = 0; rowIndex &lt; stands[columnIndex].length; rowIndex++) { //Az adott oszlop sorai(minden sorban pontosan 1db cella)

                    //
                    BoardPit pit;
                    if(this.isPitExists(columnIndex, rowIndex)) {
                        pit = this.getPit(columnIndex, rowIndex);
                    }
                    else {
                        pit = new BoardPit(this, posX + (rowIndex) * 49, posY + (rowIndex) * 23, columnIndex, rowIndex);
                        this.pitList.add(pit);
                    }

                    //
                    if(stands[columnIndex][rowIndex] != -1) {
                        if(!this.rootNode.getChildren().contains(pit)) {
                            this.addToRootNode(pit);
                        }
                    }
                    else {
                        if(this.rootNode.getChildren().contains(pit)) {
                            this.rootNode.getChildren().remove(pit);

                        }
                    }
                    //
                    pit.checkState();

                }

            }

            //
            this.getUIRoot().getChildren().add(this.rootNode);
        }*/
<span class="nc" id="L246">    }</span>

    /**
     * Occurs when a pit graphical component is clicked.
     *
     * @param columnIndex Column index of clicked pit.
     * @param rowIndex    Row index of clicked pit.
     *
     * @throws TError Thrown if an unrecoverable error was occurred.
     */
    private void pitClicked(int columnIndex, int rowIndex) throws TError {
<span class="nc bnc" id="L257" title="All 2 branches missed.">        if(this.isControllerAttached()) {</span>
<span class="nc" id="L258">            this.getControllerInstance().cellClicked(columnIndex, rowIndex);</span>
        }
<span class="nc" id="L260">    }</span>

    /**
     * Answers whether the pit exists at specified coordinates.
     *
     * @param columnIndex Column index of specified coordinate.
     * @param rowIndex    Row index of specified coordinate.
     *
     * @return True if pit exists at specified coordinates otherwise false.
     */
    private boolean isPitExists(int columnIndex, int rowIndex) {
<span class="nc" id="L271">        BoardPit pit = new BoardPit(this, 0, 0, columnIndex, rowIndex);</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">        if(this.pitList.contains(pit)) {</span>
<span class="nc" id="L273">            return true;</span>
        }
<span class="nc" id="L275">        return false;</span>
    }

    /**
     * Retrieves the pit object found at specified coordinates.
     *
     * @param columnIndex Column index of specified coordinate.
     * @param rowIndex    Row index of specified coordinate.
     *
     * @return An instance of {@code BoardPit} class.
     *
     * @throws TError Thrown if an unrecoverable error was occurred.
     */
    private BoardPit getPit(int columnIndex, int rowIndex) throws TError {
        // Input checkings
<span class="nc" id="L290">        BoardPit pit = new BoardPit(this, 0, 0, columnIndex, rowIndex);</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">        if(!this.pitList.contains(pit)) {</span>
<span class="nc" id="L292">            throw new TError(&quot;No data was found at given parameters [&quot; + columnIndex + &quot;,&quot; + rowIndex + &quot;]!&quot;);</span>
        }

        // Find data
<span class="nc" id="L296">        int indx = this.pitList.indexOf(pit);</span>
<span class="nc" id="L297">        return this.pitList.get(indx);</span>
    }

    /**
     * Adds a graphical node to the local root node.
     *
     * @param Node The graphical node to be added.
     */
    private final void addToRootNode(Node Node) {
<span class="nc" id="L306">        this.rootNode.getChildren().add(Node);</span>
<span class="nc" id="L307">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public void modelPropertyChange(PropertyChangeEvent evt) {
        try {

<span class="nc bnc" id="L316" title="All 2 branches missed.">            if(evt.getPropertyName().equals(GameData.MODIFICATIONCODE_ACTUALGAMEPLAY)) {</span>
                //String newStringValue = evt.getNewValue().toString();
                //xPositionTextField.setText(newStringValue);
                
<span class="nc" id="L320">                this.refresh();</span>
            }
            else {
<span class="nc" id="L323">                logger.warn(&quot;Unexpected property change:&quot; + evt.getPropertyName());</span>
            }
        }
<span class="nc" id="L326">        catch(TError exp) {</span>
<span class="nc" id="L327">            logger.error(exp.toString());</span>
<span class="nc" id="L328">        }</span>

<span class="nc" id="L330">    }</span>

    /**
     * Gives back the general graphical root node as actual graph framework specific.
     *
     * @return A JavaFX specific graphical node object.
     */
    private Pane getUIRoot() {
<span class="nc" id="L338">        return (Pane) super.getGraphicalRoot();</span>
    }

    /**
     * Retrieves the controller component as {@code IGameController} implementation.
     *
     * @return An instance of class implementing {@code IGameController} interface.
     */
    private IGameController getControllerInstance() {
<span class="nc" id="L347">        return (IGameController) super.getController();</span>
    }

    /**
     * Retrieves the data component as {@code IGameData} implementation.
     *
     * @return An instance of class implementing {@code IGameData} interface.
     */
    private IGameData getDataInstance() {
<span class="nc" id="L356">        return (IGameData) super.getController().getModel();</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public final void animateWhenNotAllowedPlayerClickedOnAPit(int columnIndex, int rowIndex) {
<span class="nc" id="L364">        voiceNotAllowedPlayerSelected.play();</span>
<span class="nc" id="L365">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public final void animateWhenClickedOutsideOfAttackZone(int columnIndex, int rowIndex) {
<span class="nc" id="L372">        voiceOutside.play();</span>
<span class="nc" id="L373">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public void animateAsAttackZone(int baseColumnIndex, int baseRowIndex) throws TError {
        // Input checkings
<span class="nc bnc" id="L381" title="All 2 branches missed.">        if(!this.getDataInstance().isCellExists(baseColumnIndex, baseRowIndex)) {</span>
<span class="nc" id="L382">            throw new TError(&quot;The requested coordinate[&quot; + baseColumnIndex + &quot;,&quot; + baseRowIndex + &quot;] is out of range!&quot;);</span>
        }
<span class="nc bnc" id="L384" title="All 2 branches missed.">        if(!this.isPitExists(baseColumnIndex, baseRowIndex)) {</span>
<span class="nc" id="L385">            throw new TError(&quot;The requested pit[&quot; + baseColumnIndex + &quot;,&quot; + baseRowIndex + &quot;] is not found!&quot;);</span>
        }

<span class="nc" id="L388">        voiceShowSpreadArea.play();</span>
        // Remove possible recent animation
<span class="nc" id="L390">        this.removeAllAttackZone();</span>

        // Animate base cell of attack zone
<span class="nc" id="L393">        this.animateAsAttackZoneOrigo(baseColumnIndex, baseRowIndex);</span>

        // Animate cells of attack zone
<span class="nc bnc" id="L396" title="All 2 branches missed.">        for(Coordinate relativeCoordinate : relativeCoordinatesOfAttackZone) {</span>
<span class="nc" id="L397">            int zoneColumnIndex = baseColumnIndex + relativeCoordinate.getX();</span>
<span class="nc" id="L398">            int zoneRowIndex = baseRowIndex + relativeCoordinate.getY();</span>

<span class="nc bnc" id="L400" title="All 4 branches missed.">            if(this.isPitExists(zoneColumnIndex, zoneRowIndex) &amp;&amp; this.getDataInstance().isCellExists(zoneColumnIndex, zoneRowIndex)) {</span>

<span class="nc" id="L402">                BoardPit pit = this.getPit(zoneColumnIndex, zoneRowIndex);</span>
<span class="nc" id="L403">                IField field = this.getDataInstance().getCellAsField(zoneColumnIndex, zoneRowIndex);</span>
<span class="nc bnc" id="L404" title="All 4 branches missed.">                if((pit.isInactive() == false) &amp;&amp; (field.getPlayerIndex() == 0)) {</span>
<span class="nc" id="L405">                    pit.animateAsAttackZoneCell();</span>
                }

            }
        }
<span class="nc" id="L410">    }</span>

    /**
     * Displays animation on the centre pit of attack zone. Centre pit is the clicked cell which attack zone displayed around.
     *
     * @param columnIndex Column index of centre pit.
     * @param rowIndex    Row index of centre pit.
     *
     * @throws TError Thrown if an unrecoverable error was occurred.
     */
    private void animateAsAttackZoneOrigo(int columnIndex, int rowIndex) throws TError {
<span class="nc" id="L421">        BoardPit pit = this.getPit(columnIndex, rowIndex);</span>
<span class="nc" id="L422">        IField field = this.getDataInstance().getCellAsField(columnIndex, rowIndex);</span>

<span class="nc bnc" id="L424" title="All 4 branches missed.">        if(pit != null &amp;&amp; field != null) {</span>
<span class="nc bnc" id="L425" title="All 4 branches missed.">            if(!pit.isInactive() &amp;&amp; field.getPlayerIndex() != 0) {</span>
<span class="nc" id="L426">                pit.animateForSpreadAreaCenter();</span>
            }
        }
<span class="nc" id="L429">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public final void removeAllAttackZone() throws TError {

<span class="nc bnc" id="L437" title="All 2 branches missed.">        for(BoardPit pit : this.pitList) {</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">            if(!pit.isInactive()) {</span>
<span class="nc" id="L439">                pit.removeSpreadArea();</span>
            }
<span class="nc" id="L441">        }</span>
<span class="nc" id="L442">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public final void animatePitWhenCapturedByPlayer(int columnIndex, int rowIndex, byte playerIndex) throws TError {
<span class="nc" id="L449">        BoardPit pit = this.getPit(columnIndex, rowIndex);</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">        if(pit != null) {</span>
<span class="nc" id="L451">            pit.animateForCapture();</span>
<span class="nc" id="L452">            voiceSpreadWithJump.play();</span>

        }
<span class="nc" id="L455">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public final void animatePitWhenCapturedInLocalArea(int columnIndex, int rowIndex, byte playerIndex) throws TError {
<span class="nc" id="L462">        BoardPit Pit = this.getPit(columnIndex, rowIndex);</span>
<span class="nc bnc" id="L463" title="All 2 branches missed.">        if(Pit != null) {</span>
<span class="nc" id="L464">            Pit.animateForCapture();</span>
<span class="nc" id="L465">            voiceCapture.play();</span>

        }
<span class="nc" id="L468">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public final void animatePitWhenAbandon(int columnIndex, int rowIndex) throws TError {
<span class="nc" id="L475">        BoardPit Pit = this.getPit(columnIndex, rowIndex);</span>
<span class="nc bnc" id="L476" title="All 2 branches missed.">        if(Pit != null) {</span>
<span class="nc" id="L477">            Pit.animateForGiveUp();</span>

        }
<span class="nc" id="L480">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public final void showEndGameDialog(FinishCodeEnum caseCode, byte winnerIndex) throws TError {
        // Input checkings
<span class="nc bnc" id="L488" title="All 2 branches missed.">        if(caseCode == null) {</span>
<span class="nc" id="L489">            throw new TError(&quot;The case code property should not be null!&quot;);</span>
        }
<span class="nc bnc" id="L491" title="All 2 branches missed.">        if(winnerIndex &lt; 0) {</span>
<span class="nc" id="L492">            throw new TError(&quot;The winner index property should not be less than 0!&quot;);</span>
        }

<span class="nc bnc" id="L495" title="All 4 branches missed.">        if((winnerIndex &gt; 0) &amp;&amp; (!this.getDataInstance().isPlayerExists(winnerIndex))) {</span>
<span class="nc" id="L496">            throw new TError(&quot;The requested player index &quot; + winnerIndex + &quot; does not exist!&quot;);</span>
        }

<span class="nc" id="L499">        AnchorPane contentRoot = new AnchorPane();</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">        if(winnerIndex &gt; 0) {</span>

            // Get the color of the winner
<span class="nc" id="L503">            String winnerColor = this.getDataInstance().getPlayer(winnerIndex).getPlayerColor();</span>

            // Generate a visula effect
<span class="nc" id="L506">            RadialGradient playerColorFill = new RadialGradient(0, 0, 0.3, 0.3, 1, true, CycleMethod.NO_CYCLE, new Stop[]{</span>
<span class="nc" id="L507">                new Stop(0, Color.web(winnerColor)),</span>
                new Stop(1, Color.BLACK)
            });

<span class="nc" id="L511">            DropShadow dropShadow = new DropShadow();</span>
<span class="nc" id="L512">            dropShadow.setRadius(10);</span>
<span class="nc" id="L513">            dropShadow.setColor(Color.GREY);</span>

            // Generate a hexagon shape with the color of winner player
<span class="nc" id="L516">            int centreX = 0;</span>
<span class="nc" id="L517">            int centreY = 0;</span>
            //Double[] hexaCoordinates = {centreX + 30.0, 0.0 + centreY, centreX + 90.0, 0.0 + centreY, centreX + 120.0, 40.0 + centreY, centreX + 90.0, 80.0 + centreY, centreX + 30.0, 80.0 + centreY, centreX + 0.0, 40.0 + centreY};
<span class="nc" id="L519">            Double[] hexaCoordinates = {centreX + 15.0, 0.0 + centreY, centreX + 45.0, 0.0 + centreY, centreX + 60.0, 20.0 + centreY, centreX + 45.0, 40.0 + centreY, centreX + 15.0, 40.0 + centreY, centreX + 0.0, 20.0 + centreY};</span>

<span class="nc" id="L521">            Polygon hexaShape = new Polygon();</span>
<span class="nc" id="L522">            hexaShape.getPoints().addAll(hexaCoordinates);</span>
<span class="nc" id="L523">            hexaShape.setFill(playerColorFill);</span>
<span class="nc" id="L524">            hexaShape.setId(&quot;PlayerShape&quot;);</span>
<span class="nc" id="L525">            hexaShape.setLayoutX(10);</span>
<span class="nc" id="L526">            hexaShape.setLayoutY(10);</span>
<span class="nc" id="L527">            hexaShape.setStrokeType(StrokeType.CENTERED);</span>
<span class="nc" id="L528">            hexaShape.setStroke(Color.BLACK);</span>
<span class="nc" id="L529">            hexaShape.setStrokeWidth(2);</span>
<span class="nc" id="L530">            hexaShape.setStrokeLineJoin(StrokeLineJoin.ROUND);</span>
            // hexaShape.setEffect(dropShadow);

            // Content
<span class="nc" id="L534">            Text winnerText = new Text(&quot;Is the winner!&quot;);</span>
<span class="nc" id="L535">            DropShadow dropShadow2 = new DropShadow();</span>
<span class="nc" id="L536">            dropShadow2.setRadius(10);</span>
<span class="nc" id="L537">            dropShadow2.setColor(Color.WHITE);</span>
<span class="nc" id="L538">            winnerText.setEffect(dropShadow2);</span>
<span class="nc" id="L539">            winnerText.setId(&quot;TTT&quot;);</span>

            // Adding to local roote
<span class="nc" id="L542">            contentRoot.getChildren().add(hexaShape);</span>
<span class="nc" id="L543">            contentRoot.getChildren().add(winnerText);</span>

<span class="nc" id="L545">            contentRoot.setLeftAnchor(hexaShape, Double.valueOf(10));</span>
<span class="nc" id="L546">            contentRoot.setTopAnchor(hexaShape, Double.valueOf(10));</span>
<span class="nc" id="L547">            contentRoot.setLeftAnchor(winnerText, Double.valueOf(100));</span>
<span class="nc" id="L548">            contentRoot.setTopAnchor(winnerText, Double.valueOf(10));</span>

<span class="nc" id="L550">        }</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">        else if(winnerIndex == 0) {</span>
            // Content
<span class="nc" id="L553">            Text winnerText = new Text(&quot;It is a draw!&quot;);</span>
<span class="nc" id="L554">            DropShadow dropShadow2 = new DropShadow();</span>
<span class="nc" id="L555">            dropShadow2.setRadius(10);</span>
<span class="nc" id="L556">            dropShadow2.setColor(Color.WHITE);</span>
            //winnerText.setEffect(dropShadow2);
<span class="nc" id="L558">            winnerText.setId(&quot;TTT&quot;);</span>

<span class="nc" id="L560">            contentRoot.getChildren().add(winnerText);</span>
<span class="nc" id="L561">            contentRoot.setLeftAnchor(winnerText, Double.valueOf(120));</span>
<span class="nc" id="L562">            contentRoot.setTopAnchor(winnerText, Double.valueOf(20));</span>
<span class="nc" id="L563">        }</span>
        else {
<span class="nc" id="L565">            throw new TError(&quot;Unsupported value was found!&quot;);</span>
        }

        // Generate dialog
<span class="nc" id="L569">        endGameDialog.initModality(Modality.APPLICATION_MODAL);</span>
<span class="nc" id="L570">        endGameDialog.initStyle(StageStyle.TRANSPARENT);</span>
<span class="nc" id="L571">        endGameDialog.setTitle(&quot;End of game&quot;);</span>
        //endGameDialog.setHeight(100);
        //endGameDialog.setWidth(300);

        // Set the inside of the dialog
<span class="nc" id="L576">        DialogPane dialogPane = endGameDialog.getDialogPane();</span>
<span class="nc" id="L577">        dialogPane.setId(&quot;dialog&quot;);</span>
<span class="nc" id="L578">        dialogPane.getStylesheets().add(PlayBoard.class.getResource(PlayBoard.folderCSS + &quot;/general.css&quot;).toExternalForm());</span>
<span class="nc" id="L579">        dialogPane.setHeader(contentRoot);</span>
<span class="nc" id="L580">        contentRoot.setId(&quot;content&quot;);</span>
        //DialogPane.getStylesheets().add(getClass().getResource(ViewLayerIfc.CssDirectoryPath+&quot;/GameFinishDialog.css&quot;).toExternalForm());

<span class="nc" id="L583">        endGameDialog.show();</span>

        /*String ColorString = &quot;#000000&quot;;

        //---Note:
        if(winnerIndex &gt; 0) {
            ColorString = this.getDataInstance().getPlayer(winnerIndex).getPlayerColor();
            if(ColorString == null) {
                ColorString = &quot;#000000&quot;;
            }
        }
        //---

        //---Note: A szöveges értesítés
        String contentText = &quot;&quot;;
        if(caseCode == FinishCodeEnum.BoardFull) {
            contentText = &quot;Mert nincs több szabad hely&quot;;
        }
        else if(caseCode == FinishCodeEnum.EnemyBlocked) {
            contentText = &quot;Mert az ellenség minde bábuja blokkolva van&quot;;
        }
        else if(caseCode == FinishCodeEnum.EnemyFall) {
            contentText = &quot;Mert az ellenségnek nincs több bábuja&quot;;
        }
        //---

        //---Note:
        boolean IsWinner = true;
        if(winnerIndex == 0) {
            IsWinner = false;

        }

        // Do animation on all pit when the board becomes visible
        byte[][] stands = this.getDataInstance().getCells();
        for(int columnIndex = 0; columnIndex &lt; stands.length; columnIndex++) {
            for(int rowIndex = 0; rowIndex &lt; stands[columnIndex].length; rowIndex++) {
                if(stands[columnIndex][rowIndex] &gt; 0) {
                    this.getPit(columnIndex, rowIndex).animateForFinish();
                }
            }
        }

        //((ViewLayerIfc) this.getParentComponent().getParentComponent()).showGameFinishDialog(IsWinner, ColorString, ContentText);
        //---
         */
<span class="nc" id="L629">    }</span>

    /**
     * ******************************************************************************************************
     * ******************************************************************************************************
     * ******************************************************************************************************
     */
    /**
     * Instances of this class implements a graphical component on board.
     *
     * @author Sandor Kalmanchey
     * @version 2.0
     * @since 1.0
     */
    private static class BoardPit extends Polygon {

        /**
         * Stores horizontal position of component measured in pixels.
         */
<span class="nc" id="L648">        private int posX = 0;</span>
        /**
         * Stores vertical position of component measured in pixels.
         */
<span class="nc" id="L652">        private int posY = 0;</span>
        /**
         * Stores column index of represented cell.
         */
<span class="nc" id="L656">        private int columnIndex = -1;</span>
        /**
         * Stores row index of represented cell.
         */
<span class="nc" id="L660">        private int rowIndex = -1;</span>
        /**
         *
         */
        //private int visualStatus = 0;

        /**
         * Stores the parent graphical component which is the board.
         */
<span class="nc" id="L669">        private PlayBoard parent = null;</span>
        /**
         * Stores whether the pit is active or not.
         */
<span class="nc" id="L673">        private boolean isInactive = false;</span>

        /**
         * Stores design information object.
         */
        private static LinearGradient emptyBackgroundFill;
        /**
         * Stores design information object.
         */
        private static RadialGradient spreadCenterFill;
        /**
         * Stores colour object of pit which is not under animation.
         */
        private static Color normalPitBorderColor;
        /**
         * Stores colour object of pit which is under animation.
         */
        private static Color spreadPitBorderColor;
        /**
         * Stores colour object of pit which is under animation.
         */
        private static Color animatePitBorderColor;

        static {

            // 
<span class="nc" id="L699">            BoardPit.emptyBackgroundFill = new LinearGradient(0, 0, 1, 1, true, CycleMethod.NO_CYCLE, new Stop[]{</span>
<span class="nc" id="L700">                new Stop(0, Color.rgb(150, 150, 150)),</span>
<span class="nc" id="L701">                new Stop(1, Color.rgb(15, 15, 15))</span>
            });

            // 
<span class="nc" id="L705">            BoardPit.spreadCenterFill = new RadialGradient(0, 0, 0.3, 0.3, 1, true, CycleMethod.NO_CYCLE, new Stop[]{</span>
                new Stop(0, Color.YELLOW),
                new Stop(1, Color.BLACK)
            });

<span class="nc" id="L710">            BoardPit.normalPitBorderColor = Color.BLACK;</span>
<span class="nc" id="L711">            BoardPit.spreadPitBorderColor = Color.WHITE;</span>
<span class="nc" id="L712">            BoardPit.animatePitBorderColor = Color.ORANGE;</span>

<span class="nc" id="L714">        }</span>

        /**
         * Creates a {@code BoardPit} instance.
         *
         * @param parent Parent graphical object to which it is attached.
         */
<span class="nc" id="L721">        private BoardPit(PlayBoard parent) {</span>
<span class="nc" id="L722">            this.parent = parent;</span>

<span class="nc" id="L724">        }</span>

        /**
         * Creates a {@code BoardPit} instance.
         *
         * @param parent      Parent graphical object to which it is attached.
         * @param posX        Stores horizontal position of component measured in pixels.
         * @param posY        Vertical position of component measured in pixels.
         * @param columnIndex Column index of represented cell.
         * @param rowIndex    Row index of represented cell.
         */
<span class="nc" id="L735">        BoardPit(PlayBoard parent, int posX, int posY, int columnIndex, int rowIndex) {</span>
<span class="nc" id="L736">            this.parent = parent;</span>
<span class="nc" id="L737">            this.posX = posX;</span>
<span class="nc" id="L738">            this.posY = posY;</span>
<span class="nc" id="L739">            this.columnIndex = columnIndex;</span>
<span class="nc" id="L740">            this.rowIndex = rowIndex;</span>
<span class="nc" id="L741">            this.init();</span>
<span class="nc" id="L742">        }</span>

        /**
         * Method where sub component initialisation happens.
         */
        private void init() {

            //---Note:A poligin pontjainak megadása relatív koordinátákkal
<span class="nc" id="L750">            this.getPoints().addAll(new Double[]{</span>
<span class="nc" id="L751">                this.posX + 15.0, 0.0 + this.posY, //1</span>
<span class="nc" id="L752">                this.posX + 40.0, 0.0 + this.posY, //2</span>
<span class="nc" id="L753">                this.posX + 55.0, 20.0 + this.posY, //3</span>
<span class="nc" id="L754">                this.posX + 40.0, 40.0 + this.posY, //4</span>
<span class="nc" id="L755">                this.posX + 15.0, 40.0 + this.posY, //5</span>
<span class="nc" id="L756">                this.posX + 0.0, 20.0 + this.posY //6</span>
            });
            //---

            //---Note:Formázás
<span class="nc" id="L761">            this.setFill(BoardPit.emptyBackgroundFill);</span>
<span class="nc" id="L762">            this.setStrokeType(StrokeType.CENTERED);</span>
<span class="nc" id="L763">            this.setStroke(BoardPit.normalPitBorderColor);   ////Color.rgb(88, 0, 88)</span>
<span class="nc" id="L764">            this.setStrokeWidth(3);</span>
<span class="nc" id="L765">            this.setStrokeLineJoin(StrokeLineJoin.ROUND);</span>
<span class="nc" id="L766">            this.setOpacity(1);</span>
            //---

            //---Note:Események
<span class="nc" id="L770">            final BoardPit pit = this;</span>
<span class="nc" id="L771">            this.setOnMousePressed(new EventHandler&lt;MouseEvent&gt;() {</span>
                public void handle(MouseEvent Evt) {

                    try {
<span class="nc" id="L775">                        pit.pitClicked();</span>
                    }
<span class="nc" id="L777">                    catch(TError ex) {</span>
<span class="nc" id="L778">                        logger.error(ex.toString());</span>
<span class="nc" id="L779">                    }</span>
<span class="nc" id="L780">                }</span>
            });

<span class="nc" id="L783">            this.setOnMouseEntered(new EventHandler&lt;MouseEvent&gt;() {</span>
                public void handle(MouseEvent Evt) {

<span class="nc" id="L786">                }</span>
            });

<span class="nc" id="L789">            this.setOnMouseExited(new EventHandler&lt;MouseEvent&gt;() {</span>
                public void handle(MouseEvent Evt) {

<span class="nc" id="L792">                }</span>
            });
            //---
<span class="nc" id="L795">        }</span>

        /**
         * Occurs when the pit component is clicked.
         *
         * @throws TError Thrown if an unrecoverable error was occurred.
         */
        private void pitClicked() throws TError {
<span class="nc" id="L803">            this.parent.pitClicked(this.getColumnIndex(), this.getRowIndex());</span>

<span class="nc" id="L805">        }</span>

        /**
         * ????????
         *
         * @throws TError Thrown if an unrecoverable error was occurred.
         */
        private void checkState() throws TError {
<span class="nc" id="L813">            IField Field = this.parent.getDataInstance().getCellAsField(this.columnIndex, this.rowIndex);</span>

            //---Note:
<span class="nc bnc" id="L816" title="All 2 branches missed.">            if(Field.isInactive())//Note: Ha auz adatmező inaktív cellát jelöl</span>
            {
<span class="nc" id="L818">                this.setFill(null);</span>
<span class="nc" id="L819">                this.setStrokeWidth(1);</span>
            }
            else {
                //---Note: Felhasználó színének állítása
<span class="nc bnc" id="L823" title="All 2 branches missed.">                if(Field.getPlayerIndex() != 0)//Note: Ha az adott cella egy játékos által foglalva van</span>
                {
<span class="nc" id="L825">                    IPlayer Player = this.parent.getDataInstance().getPlayer(Field.getPlayerIndex());</span>

<span class="nc" id="L827">                    String ColorString = Player.getPlayerColor();</span>

<span class="nc bnc" id="L829" title="All 2 branches missed.">                    if(ColorString == null) {</span>
<span class="nc" id="L830">                        ColorString = &quot;#000000&quot;;</span>
                    }

<span class="nc" id="L833">                    RadialGradient PlayerColorFill = new RadialGradient(0, 0, 0.3, 0.3, 1, true, CycleMethod.NO_CYCLE, new Stop[]{</span>
<span class="nc" id="L834">                        new Stop(0, Color.web(ColorString)),</span>
                        new Stop(1, Color.BLACK)
                    });

<span class="nc" id="L838">                    this.setFill(PlayerColorFill);</span>

                }
<span class="nc bnc" id="L841" title="All 2 branches missed.">                if(Field.getPlayerIndex() == 0)//Note: Ha az adott cellát nem foglalja játékos</span>
                {
<span class="nc" id="L843">                    this.setFill(BoardPit.emptyBackgroundFill);</span>
                }
                //---

            }
            //---

<span class="nc" id="L850">        }</span>

        /**
         * Displays animation when game starts.
         */
        private void animateForStart() {
            //---Note:
<span class="nc" id="L857">            ScaleTransition Scale = ScaleTransitionBuilder.create()</span>
<span class="nc" id="L858">                    .node(this)</span>
<span class="nc" id="L859">                    .duration(Duration.seconds(2))</span>
<span class="nc" id="L860">                    .fromX(0.0)</span>
<span class="nc" id="L861">                    .fromY(0.0)</span>
<span class="nc" id="L862">                    .toX(1)</span>
<span class="nc" id="L863">                    .toY(1)</span>
<span class="nc" id="L864">                    .cycleCount(1)</span>
<span class="nc" id="L865">                    .autoReverse(false)</span>
<span class="nc" id="L866">                    .build();</span>
            //---

            //---Note:
<span class="nc" id="L870">            Scale.play();</span>
            //---

<span class="nc" id="L873">        }</span>

        /**
         * Displays animation when game finishes.
         */
        private void animateForFinish() {
            StrokeTransition Anim01;

            //---Note: Animáció
<span class="nc" id="L882">            Anim01 = StrokeTransitionBuilder.create()</span>
<span class="nc" id="L883">                    .duration(Duration.seconds(0.3))</span>
<span class="nc" id="L884">                    .shape(this)</span>
<span class="nc" id="L885">                    .fromValue(BoardPit.normalPitBorderColor)</span>
<span class="nc" id="L886">                    .toValue(BoardPit.animatePitBorderColor)</span>
<span class="nc" id="L887">                    .cycleCount(6)</span>
<span class="nc" id="L888">                    .autoReverse(true)</span>
<span class="nc" id="L889">                    .build();</span>

<span class="nc" id="L891">            Anim01.play();</span>
            //---

<span class="nc" id="L894">        }</span>

        /**
         * Displays animation on pit as attack zone.
         */
        private void animateAsAttackZoneCell() {
<span class="nc" id="L900">            this.setStroke(BoardPit.spreadPitBorderColor);</span>
<span class="nc" id="L901">        }</span>

        /**
         * Displays animation on pit as centre of attack zone.
         */
        private void animateForSpreadAreaCenter() {
<span class="nc" id="L907">            this.setFill(this.spreadCenterFill);</span>
<span class="nc" id="L908">        }</span>

        /**
         * Removes attack zone animation of pit.
         *
         * @throws TError Thrown if an unrecoverable error was occurred.
         */
        private void removeSpreadArea() throws TError {
<span class="nc" id="L916">            this.setStroke(BoardPit.normalPitBorderColor);</span>
<span class="nc" id="L917">            this.checkState();</span>
<span class="nc" id="L918">        }</span>

        /**
         * Animates pit as captured.
         *
         * @throws TError Thrown if an unrecoverable error was occurred.
         */
        private void animateForCapture() throws TError {

            StrokeTransition Anim01;

            //---Note: Animáció
<span class="nc" id="L930">            Anim01 = StrokeTransitionBuilder.create()</span>
<span class="nc" id="L931">                    .duration(Duration.seconds(0.3))</span>
<span class="nc" id="L932">                    .shape(this)</span>
<span class="nc" id="L933">                    .fromValue(BoardPit.normalPitBorderColor)</span>
<span class="nc" id="L934">                    .toValue(BoardPit.animatePitBorderColor)</span>
<span class="nc" id="L935">                    .cycleCount(6)</span>
<span class="nc" id="L936">                    .autoReverse(true)</span>
<span class="nc" id="L937">                    .build();</span>

<span class="nc" id="L939">            Anim01.play();</span>
            //---

            //---Note:
<span class="nc" id="L943">            this.checkState();</span>
            //---

<span class="nc" id="L946">        }</span>

        /**
         * Displays animation when pit becomes unoccupied.
         *
         * @throws TError Thrown if an unrecoverable error was occurred.
         */
        private void animateForGiveUp() throws TError {
            StrokeTransition Anim01;

            //---Note: Animáció
<span class="nc" id="L957">            Anim01 = StrokeTransitionBuilder.create()</span>
<span class="nc" id="L958">                    .duration(Duration.seconds(0.3))</span>
<span class="nc" id="L959">                    .shape(this)</span>
<span class="nc" id="L960">                    .fromValue(BoardPit.normalPitBorderColor)</span>
<span class="nc" id="L961">                    .toValue(BoardPit.animatePitBorderColor)</span>
<span class="nc" id="L962">                    .cycleCount(6)</span>
<span class="nc" id="L963">                    .autoReverse(true)</span>
<span class="nc" id="L964">                    .build();</span>

<span class="nc" id="L966">            Anim01.play();</span>
            //---

            //---Note:
<span class="nc" id="L970">            this.checkState();</span>
            //---

<span class="nc" id="L973">        }</span>

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L977" title="All 2 branches missed.">            if(obj == null) {</span>
<span class="nc" id="L978">                return false;</span>
            }
<span class="nc bnc" id="L980" title="All 2 branches missed.">            if(getClass() != obj.getClass()) {</span>
<span class="nc" id="L981">                return false;</span>
            }
<span class="nc" id="L983">            final BoardPit other = (BoardPit) obj;</span>
            /*if(!Objects.equals(this.columnIndex, other.columnIndex)) {
                return false;
            }
            if(!Objects.equals(this.rowIndex, other.rowIndex)) {
                return false;
            }*/

<span class="nc bnc" id="L991" title="All 2 branches missed.">            if(this.columnIndex != other.columnIndex) {</span>
<span class="nc" id="L992">                return false;</span>
            }

<span class="nc bnc" id="L995" title="All 2 branches missed.">            if(this.rowIndex != other.rowIndex) {</span>
<span class="nc" id="L996">                return false;</span>
            }
<span class="nc" id="L998">            return true;</span>
        }

        /**
         * Retrieves the column index of referenced cell.
         *
         * @return An integer value 0 or higher.
         */
        private int getColumnIndex() {
<span class="nc" id="L1007">            return columnIndex;</span>
        }

        /**
         * Retrieves the row index of referenced cell.
         *
         * @return An integer value 0 or higher.
         */
        private int getRowIndex() {
<span class="nc" id="L1016">            return rowIndex;</span>
        }

        /**
         * Makes inactivate the pit.
         */
        private void inactivate() {
<span class="nc" id="L1023">            this.isInactive = true;</span>
<span class="nc" id="L1024">            this.setFill(null);</span>
<span class="nc" id="L1025">        }</span>

        /**
         * Tells whether the pit is inactive.
         *
         * @return True if pit is inactive otherwise false.
         */
        private boolean isInactive() {
<span class="nc" id="L1033">            return isInactive;</span>
        }

    }

    /**
     * Instances of this class represents coordinates storing x and y values.
     *
     * @author Sandor Kalmanchey
     * @version 1.0
     * @since 1.0
     */
    private static class Coordinate {

        /**
         * Stores the x coordinate.
         */
        private int x;
        /**
         * Stores the y coordinate.
         */
        private int y;

        /**
         * Creates a {@code Coordinate} instance.
         *
         * @param x The x coordinate.
         * @param y The y coordinate.
         */
<span class="nc" id="L1062">        public Coordinate(int x, int y) {</span>
<span class="nc" id="L1063">            this.x = x;</span>
<span class="nc" id="L1064">            this.y = y;</span>
<span class="nc" id="L1065">        }</span>

        /**
         * Retrieves the x coordinate.
         *
         * @return An integer value.
         */
        public int getX() {
<span class="nc" id="L1073">            return x;</span>
        }

        /**
         * Retrieves the y coordinate.
         *
         * @return An integer value.
         */
        public int getY() {
<span class="nc" id="L1082">            return y;</span>
        }

    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>